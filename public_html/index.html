<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>MessageInABOT</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
      
        <link href="Css/Css_Aggiuntivo.css" rel="stylesheet" type="text/css"/>
        <link href="Css/style.css" rel="stylesheet" type="text/css"/>
        <script src="https://code.jquery.com/jquery-3.0.0.js"></script>
        
       
        <script> $(function(){ $("#header_not_registered").load("Header_Not_Reg.html"); $("#header_registered").load("Header_Reg.html"); $("#footer").load("Footer.html"); }); </script>
    </head> 
    <body><script>
        
  
        
        function getCookie(name)
 {
   var re = new RegExp(name + "=([^;]+)");
   var value = re.exec(document.cookie);
   return (value != null) ? unescape(value[1]) : null;
 };
 
 
  
  function doLogout(){
    deleteCookie('token');
  };
  
  function findGetParameter(parameterName) {
    var result = null,
        tmp = [];
    var items = location.search.substr(1).split("&");
    for (var index = 0; index < items.length; index++) {
        tmp = items[index].split("=");
        if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
    }
    return result;
}
  
  //Carica gli header a seconda della situazione
var myResponseHandler = function() {
  if (this.readyState == 3 && this.status == 403) {
      
    document.getElementById("header_not_registered").style.display = 'block';
  }
};

var ResponseHandler = function() {
  if (this.readyState == 3 && this.status == 403) {
      console.log("Stronzi");
    
  }
};



        $(document).ready(function(){
            
    document.getElementById("header_not_registered").style.display = 'none';
    document.getElementById("header_registered").style.display = 'none';
    
   
  var req = new XMLHttpRequest();
  req.open('GET', "https://messageinabot.herokuapp.com/users?token="+getCookie('token'));
  req.onreadystatechange = myResponseHandler;
  req.send(); 
 
  

    $.get("https://messageinabot.herokuapp.com/users?token="+getCookie('token'),{},function(data){
      if(data.success){
        
        document.getElementById("header_registered").style.display = 'block';
        document.getElementById("nome").innerHTML = "Benvenuto" + " " + data.name;
          document.getElementById("img_profilo").src = data.image;
      }
    });
    
     
      $.get("https://messageinabot.herokuapp.com/ads?fromLast=true",{},function(data){
      if(data.success){
         
          var url = new Array();
          for(i = 0; i<6;i++){
           document.getElementById("ads_img"+i).src = data.ads[i].images[0];
           document.getElementById("ads_title"+i).innerHTML = data.ads[i].title;
           document.getElementById("ads_desc"+i).innerHTML = data.ads[i].desc;
           
         
           var tmp = document.getElementById("ads_id"+i);
           tmp.value = "Annuncio.html?id="+ data.ads[i].id;
           url[i] = tmp.value;
           
document.getElementById("ads_id"+i).setAttribute("href",url[i]);

            }
       
      }
      else{
      
      }
    });
   
   
   
   $("#ricerca").click(function(){
       var filtros = document.getElementById("filtro").value;
   var query = document.getElementById("query").value;
   if(query == null && filtros == "tutte le categorie"){
        var url = "Ricerca.html?offset=0";
   }
   if(query == " " && filtros != null){
            var url = "Ricerca.html?offset=0&category="+filtros;
       }
       
        if(query != " " && filtros == "tutte le categorie"){
            var url = "Ricerca.html?offset=0&q="+query;
       }
       
       if(query != " " && filtros != "tutte le categorie"){
           var url = "Ricerca.html?offset=0&q="+query+"&category="+filtros;
       }
   
  
   document.getElementById("ricerca").setAttribute("href",url);
 });
   
  }); 
  
  
  
        </script>
        
        <div id="header_not_registered"></div>
        <div id="header_registered"></div>
        
            <div class="container  background-full-site">
                
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                
                <div class="justify-content-center">
                        <div class="row">
                      
                        <!-- Da fare la funzione di ricerca -->
                       <form class="barra-ricerca" method="get">
                                                  
                           <select class="form-control col-md-2 col-sm-1"  id="filtro" name="filtro">
                                    
                                    <option selected value='libri'>Libri</option>
                                    <option value='appunti'>Appunti</option>
                                    <option value='stage/Lavoro'>Stage/Lavoro</option>   
                                    <option value='ripetizione'>Ripetizione</option>                                    
                                    <option value='eventi'>Eventi</option>
                                    <option value='tutte le categorie'>Tutte le categorie</option>
                                    
                                </select>
                              
                            <!-- search box -->
                            <input class="form-control navbar-light pannello-ricerca col-md-8 col-sm-6" id="query" type="text" name="ricerca">
                            <a class="btn btn-success col-md-1 col-xs-1" id="ricerca">Ricerca</a>
                            
                                
                           
                          
                        </form>
                        </div>
                    </div>
                
                <div class="margine_articoli  ">
                
                    
                    <div class="card-deck">
  <div class="card">
      
    <div class="conta">  <img class="card-img-top" id="ads_img0"  alt="Card image cap"></div>
     
    <div class="card-body">
        <h4 class="card-title" id="ads_title0"></h4>
      <p class="card-text" id="ads_desc0"></p>
      <a id="ads_id0"  class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
                        
  <div class="card">
      <div class="conta">  <img class="card-img-top" id="ads_img1"  alt="Card image cap"></div>
    <div class="card-body">
        <h4 class="card-title" id="ads_title1"></h4>
      <p class="card-text" id="ads_desc1"></p>
      <a id="ads_id1"   class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
  <div class="card">
     <div class="conta">  <img class="card-img-top" id="ads_img2"  alt="Card image cap"></div>
    <div class="card-body">
        <h4 class="card-title" id="ads_title2"></h4>
      <p class="card-text" id="ads_desc2"></p>
    <a id="ads_id2"   class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
                        
        <div class="card">
   <div class="conta">  <img class="card-img-top" id="ads_img3"  alt="Card image cap"></div>
    <div class="card-body">
        <h4 class="card-title" id="ads_title3"></h4>
      <p class="card-text" id="ads_desc3"></p>
     <a id="ads_id3"   class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
                        
                        <div class="card">
      
    <div class="conta">  <img class="card-img-top" id="ads_img4"  alt="Card image cap"></div>
     
    <div class="card-body">
        <h4 class="card-title" id="ads_title4"></h4>
      <p class="card-text" id="ads_desc4"></p>
      <a id="ads_id4"  class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
                        
  <div class="card">
      <div class="conta">  <img class="card-img-top" id="ads_img5"  alt="Card image cap"></div>
    <div class="card-body">
        <h4 class="card-title" id="ads_title5"></h4>
      <p class="card-text" id="ads_desc5"></p>
     <a id="ads_id5"   class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
  
                        
                        
</div>
                    
                    
              
            </div>
                
                
            </div>
      
        <div id="footer" class="margine_articoli"></div></body>
    
</html>
