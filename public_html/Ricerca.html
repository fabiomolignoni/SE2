<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>MessageInABOT</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
      
        <link href="Css/Css_Aggiuntivo.css" rel="stylesheet" type="text/css"/>
        <link href="Css/style.css" rel="stylesheet" type="text/css"/>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
       
        <script> $(function(){ $("#header_not_registered").load("Header_Not_Reg.html"); $("#header_registered").load("Header_Reg.html"); $("#footer").load("Footer.html"); }); </script>
    </head> 
    <body><script>
        
  
        
        function getCookie(name)
 {
   var re = new RegExp(name + "=([^;]+)");
   var value = re.exec(document.cookie);
   return (value != null) ? unescape(value[1]) : null;
 };
 
 
  
  function doLogout(){
    deleteCookie('token');
  };
  
  function findGetParameter(parameterName) {
    var result = null,
        tmp = [];
    var items = location.search.substr(1).split("&");
    for (var index = 0; index < items.length; index++) {
        tmp = items[index].split("=");
        if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
    }
    return result;
}
  
  //Carica gli header a seconda della situazione
var myResponseHandler = function() {
  if (this.readyState == 3 && this.status == 403) {
    document.getElementById("header_not_registered").style.display = 'block';
  }
};



        $(document).ready(function(){
            
    document.getElementById("header_not_registered").style.display = 'none';
    document.getElementById("header_registered").style.display = 'none';
    document.getElementById("first_page").style.display = 'none';
    document.getElementById("second_page").style.display = 'none';
    document.getElementById("third_page").style.display = 'none';
    document.getElementById("pagina_princ").style.display = 'none';
   
  var req = new XMLHttpRequest();
  req.open('GET', "https://messageinabot.herokuapp.com/users?token="+getCookie('token'));
  req.onreadystatechange = myResponseHandler;
  req.send();

    $.get("https://messageinabot.herokuapp.com/users?token="+getCookie('token'),{},function(data){
      if(data.success){
        
        document.getElementById("header_registered").style.display = 'block';
        document.getElementById("nome").innerHTML = "Benvenuto" + " " + data.name;
          document.getElementById("img_profilo").src = data.image;
      }
    });
    
   var query = findGetParameter("q");
   var filtros = findGetParameter("category");
   var offset_value = findGetParameter("offset");
   
   jQuery.get("https://messageinabot.herokuapp.com/ads?q="+ query+"&category="+filtros+"&offset="+offset_value,{},function(data){
      
        if(data.success){
        var url = new Array();
        var offset_url = new Array();
        var length = data.ads.length;
        var pag = length /3;
        
        offset_url[0] = "Ricerca.html?q="+query+"&category="+filtros+"&offset=0";
        offset_url[1] = "Ricerca.html?q="+query+"&category="+filtros+"&offset=3";
        offset_url[2] = "Ricerca.html?q="+query+"&category="+filtros+"&offset=6";
        offset_url[3] = "index.html";
        
       document.getElementById("first_page").setAttribute("href",offset_url[0]);
    document.getElementById("second_page").setAttribute("href",offset_url[1]);
    document.getElementById("third_page").setAttribute("href",offset_url[2]);
    document.getElementById("pagina_princ").setAttribute("href",offset_url[3]);
        if(pag >1 ){
        document.getElementById("first_page").style.display = 'block';
    document.getElementById("second_page").style.display = 'block';
    document.getElementById("third_page").style.display = 'block';
    
    
    
    
          
          }
          document.getElementById("pagina_princ").style.display = 'block';
          for(i = 0; i<3;i++){
              if(data.ads[i] != null){
       document.getElementById("ads_img"+i).src = data.ads[i].images[0];
           document.getElementById("ads_title"+i).innerHTML = data.ads[i].title;
           document.getElementById("ads_desc"+i).innerHTML = data.ads[i].desc;
           
         
           var tmp = document.getElementById("ads_id"+i);
           tmp.value = "Annuncio.html?id="+ data.ads[i].id;
           url[i] = tmp.value;
           
document.getElementById("ads_id"+i).setAttribute("href",url[i]);
           
       }
       else{
       document.getElementById("card_"+i).style.display = 'none';
       }
   }
   
            }
    });
    
    
   
  }); 
  
  
        </script>
        
        <div id="header_not_registered"></div>
        <div id="header_registered"></div>
        
            <div class="container  background-full-site">
                <div class="row">
                
                <br>
                <br>
                <br>
                
                
                <div class="margine_articoli_piccoli col-md-1 btn-group-vertical">
                    <button class="btn btn-success">Gratis</button>
                    
                    
</div>
                
                <div class="margine_articoli  ">
                
                    
                    <div class="col-md-8 card-deck">
                        <div class="card" id="card_0">
      <img class="card-img-top" id="ads_img0"  alt="Card image cap">
     
    <div class="card-body">
        <h4 class="card-title" id="ads_title0"></h4>
      <p class="card-text" id="ads_desc0"></p>
      <a id="ads_id0"  class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
                        
  <div class="card" id="card_1">
      <img class="card-img-top" id="ads_img1"  alt="Card image cap">
    <div class="card-body">
        <h4 class="card-title" id="ads_title1"></h4>
      <p class="card-text" id="ads_desc1"></p>
     <a id="ads_id1" href="ads_id1"  class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
  <div class="card" id="card_2">
      <img class="card-img-top" id="ads_img2"  alt="Card image cap">
    <div class="card-body">
        <h4 class="card-title" id="ads_title2"></h4>
      <p class="card-text" id="ads_desc2"></p>
    <a id="ads_id2" href="ads_id2"  class="btn btn-success">Vai all'annuncio</a>
    </div>
   
  </div>
                        
        
                        
                        
</div>
                    
                    
              
            </div>
                
                </div>
                
                <div class="row margine_articoli_piccoli justify-content-center" aria-label="Page navigation example">
  <ul class="pagination">
    
      <li class="page-item"><a class="page-link" id="first_page" href="">1</a></li>
    <li class="page-item"><a class="page-link" id="second_page" >2</a></li>
    <li class="page-item"><a class="page-link" id="third_page">3</a></li>
    <li class="page-item"><a class="page-link" id="pagina_princ">Ritorna alla pagina principale</a></li>
   
  </ul>
        </div>
            </div>
      
        
        
        <div id="footer" class="margine_articoli"></div></body>
    
</html>
